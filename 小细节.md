# 练习过程中遇到的小细节/易错点

1. 输入区间时 **不要加方括号**，会报错。如`t=[-1:0.05:2]`是错误的，`t=-1:0.05:2`才是正确的。

2. 阶跃函数u(t)的定义

- 用比较运算符定义

``` matlab
u= (t>0); % 用比较运算符定义阶跃函数u(t)
```

- 用函数定义

`heaviside(t)`就是阶跃函数u(t)的函数表示

3. **延时信号的表示方法**

[CSDN参考链接：时延信号的表示方式](https://blog.csdn.net/qq_22465641/article/details/83549699)

设采样率为fs，时延τ。那么相当于参考信号整个向正方时移fs·τ个点，前fs·τ个点补零，s2=[0,0,……,0,s1]。
用Matlab写法为s2=[zeros(1,fs*τ),s1]。

其中fs是抽样间隔T对应的频率，即fs=1/T

例：

```matlab
t=-1:0.05:2;
% 如何延时
% z2(t)=x(t-0.5)
z2tmp = [zeros(1,0.5/0.05),x]; % 求z2：先在x前加若干个0，对应于延时0.5s
z2 = z2tmp(1:length(x)); % 再截取前面的若干个抽样点，保证t等长。
```
其中,zeros(m,n)函数用于生成一个大小w为m*n的全零矩阵，length(x)函数用于计算矢量x的长度。

4. 如何改变图像的周期/频率

例如，z3(t)=x(2t)

``` matlab
% 如何改变图像的周期/频率
% z3(t)=x(2t)
z3 = x(1:2:length(x)); 
t3 = t(1:2:length(t))/2;
% 直接从x中抽取出z3，但这样做的抽样时间和样本点数都和t不对应，所以需要定义新的t3和z3对应
```

5. subs函数的使用

**利用subs函数能够直接解决3&4中的问题**

> sub指令的功能语法：subs能够在符号表达式和符号矩阵中进行置换操作。
> 
> 它的调用语法规则：
> 
> - R = subs(S)         %将表达式S中的所有变量用调用的函数或MATLAB workspace中获得的值进行置换，将置换后的表达式赋给R；
>
> - R = subs(S, new)     %用new置换表达式S中的自变量后在赋给R；利用new的值代替符号表达式S中的默认符号。
>
> - R = subs(S, old, new)  %用new置换表达式中的old，然后将置换完的表达式赋给R。old为符号变量或是字符串变量名。new是一个符号货数值变量或表达式。也就是说R =  subs(S,old,new)在old=new的条件下重新计算了表达式S。

例如：
``` matlab
clear;

% 各个信号的定义

syms t x y z1 z2 z3 z4 z5 % 声明说明符号变量

x = sin(2*pi*t).*heaviside(t);
y = exp(-t).*heaviside(t);
z1 = 2 * x;
z4 = x + y;
z5 = x .* y;
z2 = subs(x, t, t-1); % z2(t)=x(t-0.5)
z3 = subs(x, t, 2*t); % z3(t)=x(2t)

x1 = subs(x, t, -1:0.05:2);

```

虽然我们可以用这种方式定义出各个信号，但是在实际的matlab运行中，可以发现每个信号的值都是syms格式的。
因此，即使用`x1 = subs(x, t, -1:0.05:2);`也只能得到表达式，而不能得到一个数值；所以得到的信号不能用plot函数绘制。

而**当不使用syms声明符号变量时，不能调用subs函数。**


6. syms类型的转换

[参考1](https://blog.csdn.net/weixin_30362233/article/details/99976422)

[参考2](https://www.cnblogs.com/MarshallL/p/4042673.html)

```matlab
double(sym型变量)
double(x)
```

采用如上的形式可以将matlab中syms类型的变量转变成双精度。


7. 傅里叶变换和傅里叶逆变换

```matlab
clear;

T = 2;%时域抽样时间区间长度
N = 2000;%抽样点数
t = linspace(-T/2,T/2-T/N,N)';%时域抽样点矩阵

f = (t>-1/2&t<1/2);%时域信号：矩形脉冲

OMG = 16*pi;%频域抽样区间长度
K = 1000;%频域抽样点数
omg = linspace(-OMG/2,OMG/2-OMG/K,K)';%频域抽样点矩阵

% 傅里叶变换
U = exp(- 1i * kron(omg, t.'));
F = T/N * U * f;
% 傅里叶逆变换
V = exp(1i * kron(t, omg .'));
fs = OMG/2/pi/K * V * F;

subplot(1,2,1);
plot(t,f,'k-',t,fs,'b-.');
legend('f(t)','f_s(t)');
xlabel('t');
ylabel('f(t)');

subplot(1,2,2);
plot(omg,F,'k');
xlabel('\Omega');
ylabel('F(\Omega)');

```

8. 函数prefourier的应用——简单快捷地求傅里叶变换和傅里叶逆变换

prefourier的定义：

```matlab
function [t,omg,FT,IFT] = prefourier(Trg,N,OMGrg,K)
% 输入参数： 
% Trg  : 二维矢量，两个元素分别表示时域信号的起止时间；
% N    : 时域抽样数量；
% OMGrg: 二维矢量，两个元素分别表示频谱的起止频率；
% K    : 频域抽样数量。
% 输出参数：
% t    : 抽样时间；
% omg  : 抽样频率；
% FT   : 实现傅里叶变换的矩阵~U~及系数；
% IFT  : 实现傅里叶逆变换的矩阵~V~及系数。
T = Trg(2)-Trg(1);
t = linspace(Trg(1),Trg(2)-T/N,N)';
OMG = OMGrg(2)-OMGrg(1);
omg = linspace(OMGrg(1),OMGrg(2)-OMG/K,K)';
FT = T/N*exp(-1i*kron(omg,t.'));
IFT = OMG/2/pi/K*exp(1i*kron(t,omg.'));

```

利用prefourier求出的FT左乘相应的时域信号，就可以得到时域信号对应的傅里叶变换；对应的IFT左乘相应的频域信号，就可以得到对应的傅里叶逆变换。

```matlab

clear;

% 一个周期的抽样数据
[t1,omg1,FT1,IFT1] = prefourier([0,1],500,[-25,25],500);
x1 = (1-t1).*(t1>0&t1<1);
X1 = FT1 * x1;

% 五个周期的抽样数据
[t,omg,FT,IFT] = prefourier([0,5],500,[-25,25],500);
x = (t>0 & t<1).*(1-t) + (t>1 & t<2).*(2-t) + (t>2 & t<3).*(3-t) + (t>3 & t<4).*(4-t) + (t>4 & t<5).*(5-t);
X = FT * x;

% 绘图
subplot(2,2,1);
plot(t1,x1,'k');
xlabel('t');
ylabel('x_1(t)');

subplot(2,2,2);
plot(omg1,X1,'k');
xlabel('\omega');
ylabel('X_1(\omega)');

subplot(2,2,3);
plot(t,x,'k');
xlabel('t');
ylabel('x(t)');

subplot(2,2,4);
plot(omg,X,'k');
xlabel('\omega');
ylabel('X(\omega)');

```

结果图片参见[傅里叶变换结果](https://github.com/Evelyn-coral/matlab-learning-record/blob/2021-summer/%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2.bmp)

9. 拉普拉斯变换

```matlab
clear;

t1=[0:0.01:3]';
b1 = [4, 5];
a1 = [1, 5, 6];
sys1=tf(b1,a1);

figure;

subplot(2,2,1);
[h11,t11]=impulse(sys1,t1);
plot(t11,h11,'k');
title('Impulse Response');
xlabel('Time(Sec)');
ylabel('Amplitude - 1');

subplot(2,2,2);
x_delta = zeros(size(t1));
x_delta(t1==0) = 100;
[H12,t12]=lsim(sys1,x_delta,t1);
% h12 = H12 - x_delta;这里不能减去δ（t）
plot(t12, H12 ,'k');
title('Impulse Response - lsim');
xlabel('Time(Sec)');
ylabel('Amplitude - 1');

t2=[0:0.01:20]';
b2 = [1, 0, 2];
a2 = [1, 0, 1];
sys2 = tf(b2, a2);

subplot(2,2,3);
[h21, t21] = impulse(sys2, t2);
plot(t21, h21, 'k');
title('Impulse Response');
xlabel('Time(Sec)');
ylabel('Amplitude - 2');

subplot(2,2,4);
y_delta = zeros(size(t2));
y_delta(t2==0) = 100;
[H22, t22] = lsim(sys2, y_delta, t2);
h22 = H22 - y_delta;
plot(t22, h22,'k');
title('Impulse Response - lsim');
xlabel('Time(Sec)');
ylabel('Amplitude - 2');

```

这里主要是练习利用`residue`函数求拉氏变换的零极点，然后用`zp2tf()`函数转化为系统传递函数模型，然后用`impulse()`函数求冲激响应。

注意这里的H12是用构造的δ函数用`lsim`来求冲激响应，但是不能再减去δ函数了。（我也不知道为什么）


10. 频率响应

用`freqs`函数计算频率响应。

`h=freqs(b,a,w)` w 是频率取样点，b, a分别对应传递函数的分子、分母的多项式系数向量，h是频率响应再频率取样上的数值向量。

下面这个例子就是求 $\displaysytle H(s)=frac(1)(s^3+2s^2+2s+1)$的传递函数对应的频率响应：

```matlab
clear;

b = [1];
a = [1, 2, 2, 1];
omg = [0:0.01:6];
H = freqs(b, a, omg);
plot(omg, H, 'k');
xlabel('\omega');
ylabel('H(\omega)');
```

11. 综合求解冲激响应、频率响应、零极点分布图

```matlab
clear;

b = [3, 9, 8];
a = [2, 10, 12];
t = [0:0.01:4]';
sys = tf(b, a);

% 冲激响应
subplot(2,2,1);
h = impulse(sys, t);
plot(t, h, 'k');
title('Impulse Response');
xlabel('Time(Sec)');
ylabel('Amplitude');

% 频率响应
subplot(2,2,2);
omg = [-6*pi:0.01:6*pi];
H = freqs(b,a,omg);
plot(omg,abs(H),'k');
title('Frequency Response');
xlabel('\omega');
ylabel('H(\omega)');

% 零极点分布图
subplot(2,2,3);
pzmap(b,a);
```









